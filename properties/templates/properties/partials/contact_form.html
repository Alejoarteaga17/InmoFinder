include {% load static %}
<div class="modal-header">
    <h5 class="modal-title">Contact Owner</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
    <form method="post" id="contactForm" action="{% url 'contact_owner' propiedad.id %}">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="mb-2">
        {{ form.nombre.label_tag }}
        {{ form.nombre }}
        {{ form.nombre.errors }}
    </div>
    <div class="mb-2">
        {{ form.email.label_tag }}
        {{ form.email }}
        {{ form.email.errors }}
    </div>
    <div class="mb-2">
        {{ form.mensaje.label_tag }}
        {{ form.mensaje }}
        {{ form.mensaje.errors }}
    </div>
    <div class="d-flex justify-content-end">
        <button class="btn btn-dark mt-2" type="submit">Enviar mensaje</button>
    </div>
    </form>
    <!-- Mensaje de √©xito din√°mico -->
    <div id="formMessage" class="alert d-none mt-3"></div>
</div>


<script>
    form.addEventListener("submit", function(e) {
        e.preventDefault();  // üö® detener el env√≠o normal del form

        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
                "X-Requested-With": "XMLHttpRequest"
            }
        })
        .then(response => response.json())
        .then(data => {
            msg.classList.remove("d-none", "alert-success", "alert-danger");
            if (data.success) {
                msg.classList.add("alert-success");
                msg.innerHTML = data.message;

                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById("contactModal"));
                    modal.hide();
                    msg.classList.add("d-none");
                    form.reset();
                }, 2000);
            } else {
                msg.classList.add("alert-danger");
                msg.innerHTML = "‚ùå Corrige los errores: " + JSON.stringify(data.errors);
            }
        })
        .catch(error => {
            msg.classList.remove("d-none");
            msg.classList.add("alert-danger");
            msg.innerHTML = "‚ö†Ô∏è Error al enviar el mensaje.";
            console.error("Error:", error);
        });
    });
</script>

