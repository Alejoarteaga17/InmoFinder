{% extends "properties/base.html" %}
{% load static %}

{% block title %}Property Media — {{ propiedad.title }}{% endblock %}

{% block styles %}
<style>
  .media-page { padding-top: 1rem; }

  .media-box {
    max-width: 1100px;
    margin: 0 auto;
    background: #fff;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .media-upload {
    margin-bottom: 2rem;
    padding: 1rem;
    border: 1px dashed #ccc;
    border-radius: 8px;
    background: #f9f9f9;
  }

  .media-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 1rem;
  }

  .card-media {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 8px;
    padding: .75rem;
    text-align: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }

  .card-media img, .card-media video {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 8px;
  }

  .muted { color: #666; font-size: 0.95rem; }

  /* === Tus botones personalizados (ignoran Bootstrap) === */
  .media-page .btn,
  .media-page .btn:focus,
  .media-page .btn:active {
    background: #1976d2 !important;
    color: #fff !important;
    border: none !important;
    padding: 0.45rem 0.9rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.92rem;
    text-decoration: none;
    box-shadow: none !important;
  }

  .media-page .btn:hover {
    background: #125ea3 !important;
    color: #fff !important;
  }

  .media-page .btn-danger,
  .media-page .btn-danger:focus,
  .media-page .btn-danger:active {
    background: #d32f2f !important;
    color: #fff !important;
    border: none !important;
  }

  .media-page .btn-danger:hover {
    background: #b71c1c !important;
    color: #fff !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="media-page">
  <div class="media-box">
    <div class="mb-3">
      {% if user.is_admin %}
        <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary btn-sm">← Back to Dashboard</a>
      {% else %}
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary btn-sm">← Back to Dashboard</a>
      {% endif %}
    </div>

    <h1 class="h3 mb-1">Media for “{{ propiedad.title }}”</h1>
    <p class="muted mb-4">Upload up to 10 images or videos for this property.</p>

    <!-- Upload form -->
    <form class="media-upload" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <label class="form-label"><strong>Select files:</strong></label>
      <input type="file" name="file" multiple accept="image/*,video/*" class="form-control mb-3">
      <button type="submit" class="btn">Upload</button>
    </form>

    <h2 class="h5">Existing Media</h2>
    {% if medias %}
      <div class="media-grid">
        {% for m in medias %}
          <div class="card-media">
            {% if m.tipo == "video" %}
              <video src="{{ m.media_url }}" controls></video>
            {% else %}
              <img src="{{ m.media_url }}" alt="Image">
            {% endif %}
            <p class="muted mt-2">{{ m.tipo|title }}</p>
            <form method="post" action="{% url 'media_delete' propiedad.id m.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No media files yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
